
-- chay script
update ASS_MASTER set LIQ_W_STATUS = '0'


3/4/2020


	Đổi menu cho khách hàng 8.6 BC CP CCLD PS từ ...đến... qua "Báo cáo thống kê CCLĐ"


-- chay script

UPDATE dbo.TR_CONTRACT SET CTR_TYPE = 'BT'
delete TL_MENU where MENU_NAME_EL = 'BuildingContract'


-- chinh sua lai menu khai thac tru sơ

update TL_MENU set MENU_NAME = N'Quản lý khai thác trụ sở trống' where MENU_NAME_EL = 'RentManagement'
update TL_MENU set MENU_NAME = N'Thông tin khai thác trụ sở' where MENU_NAME_EL = 'BudRegister'
declare @parentId int
select @parentId = MENU_ID from TL_MENU where MENU_NAME_EL = 'RentManagement'
update TL_MENU set MENU_PARENT = @parentId, MENU_NAME =N'Báo cáo tình hình khai thác trụ sở' where MENU_NAME_EL = 'ReBudRegister'
delete TL_MENU where MENU_NAME_EL = 'BuildingContract'
delete TL_MENU where MENU_NAME_EL = 'AssBuilding'

-- xoa du lieu ho so cong trinh cu
declare @datedelete datetime = '2020-01-01 00:00:00.000'
delete CON_REQUEST_DOC
where CREATE_DT < @datedelete

delete BID_MASTER
where BID_TYPE = 2
and CREATE_DT < @datedelete


delete BID_CONTRACTOR_DT
where BID_ID in (select BID_ID from BID_MASTER where BID_TYPE = 2 and CREATE_DT < @datedelete)


delete TR_CONTRACT
where CONTRACT_TYPE = 2
and CREATE_DT < @datedelete


delete TR_CONTRACT_PAYMENT
where CONTRACT_ID in (select CONTRACT_ID from TR_CONTRACT where CONTRACT_TYPE = 2 and CREATE_DT < @datedelete)
--------------------------------------------------------------------------------------------------------------------------------
delete CON_MASTER


declare @branch_id varchar(15) = 'DV0001'

declare @tmp table(branch_id varchar(15))

insert into @tmp
select * from dbo.CM_BRANCH_GETCHILDID(@branch_id)


select * from ASS_MASTER
where BRANCH_ID in (select * from @tmp)

go

declare @branch_id varchar(15) = 'DV0001'

declare @tmp table(branch_id varchar(15))

insert into @tmp
select * from dbo.CM_BRANCH_GETCHILDID(@branch_id)


select * from ASS_MASTER a
inner join @tmp t
on a.BRANCH_ID = t.branch_id

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

exec TR_PO_UP_MASTER_Search @p_PO_ID=NULL,@p_PO_CODE=NULL,@p_PO_NAME=NULL,@p_CONTRACT_ID=NULL,@p_SUP_ID=NULL,@p_SUP_NAME=NULL,@p_SUP_ADDR=NULL,@p_INPUT_DT=NULL,@p_PAYMENT_DT=NULL,@p_TOTAL_AMT=NULL,@p_REQ_DOC_ID=NULL,@p_DELIVERY_DT=NULL,@p_PAYAPP_DT=NULL,@p_RECORD_STATUS=NULL,@p_MAKER_ID=NULL,@p_CREATE_DT=NULL,@p_AUTH_STATUS=NULL,@p_CHECKER_ID=NULL,@p_APPROVE_DT=NULL,@P_PO_TYPE=NULL,@p_BRANCH_ID=NULL,@p_BRANCH_LOGIN=N'DV0001',@p_CONTRACT_CODE=NULL,@p_RECEIVE_BRANCH=N'DV0001',@P_LEVEL=N'ALL',@P_FROM_DATE=NULL,@P_TO_DATE=NULL,@p_ISUPDATE=NULL,@p_ISAPPROVE=NULL,@P_TOP=NULL

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- PROCEDURE NAME: TR_PO_UP_MASTER_Search

DECLARE @P_PO_TYPE int = NULL,
@p_PO_CODE varchar(15) = NULL,
@p_PO_ID varchar(15) = NULL,
@p_TOTAL_AMT decimal = NULL,
@p_PO_NAME nvarchar(200) = NULL,
@p_CONTRACT_ID varchar(15) = NULL,
@p_SUP_ID varchar(15) = NULL,
@p_SUP_NAME nvarchar(200) = NULL,
@p_SUP_ADDR nvarchar(200) = NULL,
@p_INPUT_DT varchar(20) = NULL,
@p_PAYMENT_DT varchar(20) = NULL,
@p_REQ_DOC_ID varchar(15) = NULL,
@p_DELIVERY_DT varchar(20) = NULL,
@p_PAYAPP_DT varchar(20) = NULL,
@p_RECORD_STATUS varchar(1) = NULL,
@p_MAKER_ID varchar(15) = NULL,
@p_CREATE_DT varchar(20) = NULL,
@p_AUTH_STATUS varchar(50) = NULL,
@p_CHECKER_ID varchar(15) = NULL,
@p_APPROVE_DT varchar(20) = NULL,
@p_CONTRACT_CODE varchar(15) = NULL,
@P_FROM_DATE nvarchar(20) = NULL,
@P_TO_DATE nvarchar(20) = NULL,
@p_RECEIVE_BRANCH varchar(15) = N'DV0001',
@P_TOP int = NULL,
@p_BRANCH_ID varchar(15) = NULL,
@P_LEVEL varchar(10) = N'ALL',
@p_BRANCH_LOGIN varchar(15) = N'DV0001',
@p_ISUPDATE varchar(1) = NULL,
@p_ISAPPROVE varchar(1) = NULL

declare @tmp table(BRANCH_ID varchar(15))
insert into @tmp  SELECT BRANCH_ID  FROM [dbo].[CM_BRANCH_GETCHILDID](@p_BRANCH_ID)

DECLARE @l_BRANCH_TYPE VARCHAR(15) = ''
SELECT @l_BRANCH_TYPE = BRANCH_TYPE FROM CM_BRANCH WHERE BRANCH_ID = @p_BRANCH_LOGIN
--LAY GIA TRI QUY DINH LA TSCD HAY CCLD
DECLARE @l_ASSET_VALUE DECIMAL = 30000000
SELECT @l_ASSET_VALUE = CONVERT(decimal(18,0), ParaValue) FROM SYS_PARAMETERS WHERE ParaKey = 'ASSET_VALUE'


	IF(@P_TOP IS NULL OR @P_TOP = '' OR @P_TOP = 0)
		
		-- PAGING BEGIN
BEGIN
SELECT COUNT(*) -- SELECT END
		FROM
		(
		--PO CHINH
		(
		SELECT  A.PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME, E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				@p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'PO' AS POKIND
		FROM TR_PO_MASTER A 		
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS		
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	    AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_ID FROM TR_PO_DETAIL PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_ID = A.PO_ID )
							 -- OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							 )
							 )
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'PO' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
		)
		UNION
		(
		--PO SUA CHUA
		SELECT  A.PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME, E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				@p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'POSC' AS POKIND
		FROM TR_PO_MASTER A 		
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS		
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	    AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_REPAIR_ID FROM TR_PO_REPAIR_DT PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_REPAIR_ID = A.PO_ID )
							 -- OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							 )
							 )
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'POSC' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
		)
		) AS A
		
		;WITH QUERY_DATA AS ( 
		SELECT * 
		, ROW_NUMBER() OVER (ORDER BY  A.PO_CODE DESC, A.INPUT_DT DESC) AS __ROWNUM-- SELECT END
		FROM
		(
		--PO CHINH
		(
		SELECT  A.PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME, E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				@p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'PO' AS POKIND
		FROM TR_PO_MASTER A 		
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS		
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	    AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_ID FROM TR_PO_DETAIL PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_ID = A.PO_ID )
							 -- OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							 )
							 )
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'PO' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
		)
		UNION
		(
		--PO SUA CHUA
		SELECT  A.PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME, E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				@p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'POSC' AS POKIND
		FROM TR_PO_MASTER A 		
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS		
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	    AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_REPAIR_ID FROM TR_PO_REPAIR_DT PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_REPAIR_ID = A.PO_ID )
							 -- OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							 )
							 )
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'POSC' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
		)
		) AS A
		
		) SELECT * FROM QUERY_DATA WHERE __ROWNUM > 0 AND __ROWNUM <= 10
END-- PAGING END
   ELSE
   -- PAGING BEGIN
BEGIN
SELECT COUNT(*) -- SELECT END
   FROM (
		--po chinh
		(SELECT TOP(CONVERT(INT,@P_TOP)) 
		A.PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME,  E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				 @p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				 CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'PO' AS POKIND
		FROM TR_PO_MASTER A 
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID --AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	   AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_ID FROM TR_PO_DETAIL PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_ID = A.PO_ID )
							  --OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							  ))
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'PO' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
			
		)
		UNION
------------------po sua chu
		(
		SELECT TOP(CONVERT(INT,@P_TOP)) 
		A.PO_REPAIR_ID AS PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME,  E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				 @p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				 CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'POSC' AS POKIND
		FROM TR_PO_REPAIR A 
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_REPAIR_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID --AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	   AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_REPAIR_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_REPAIR_ID FROM TR_PO_REPAIR_DT PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_REPAIR_ID = A.PO_REPAIR_ID )
							  --OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							  ))
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_REPAIR_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_REPAIR_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'POSC' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
			ORDER BY PO_CODE DESC, INPUT_DT DESC
		)
		
		) A
		
		;WITH QUERY_DATA AS (  
   SELECT 
   *
   , ROW_NUMBER() OVER (ORDER BY  A.PO_CODE DESC, A.INPUT_DT DESC) AS __ROWNUM-- SELECT END
   FROM (
		--po chinh
		(SELECT TOP(CONVERT(INT,@P_TOP)) 
		A.PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME,  E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				 @p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				 CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'PO' AS POKIND
		FROM TR_PO_MASTER A 
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID --AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	   AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_ID FROM TR_PO_DETAIL PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_ID = A.PO_ID )
							  --OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							  ))
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'PO' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
			
		)
		UNION
------------------po sua chu
		(
		SELECT TOP(CONVERT(INT,@P_TOP)) 
		A.PO_REPAIR_ID AS PO_ID,
				A.PO_CODE,A.PO_NAME,A.CONTRACT_ID,A.SUP_ID,A.SUP_NAME,A.SUP_ADDR,A.INPUT_DT,A.PAYMENT_DT,A.TOTAL_AMT,A.REQ_DOC_ID,
				A.DELIVERY_DT,A.PAYAPP_DT,A.NOTES,A.RECORD_STATUS,
				B.MAKER_ID,
				B.CREATE_DT,B.AUTH_STATUS,B.CHECKER_ID,B.APPROVE_DT,A.PO_TYPE,B.BRANCH_ID,
		B.PO_UP_ID,B.AUTH_STATUS STATUS_CODE,
		C.CONTRACT_CODE, D.AUTH_STATUS_NAME,  E.SUP_CODE AS S_SUP_CODE, E.SUP_NAME AS S_SUP_NAME, E.ADDR AS S_ADDR,
				F.CONTRACT_CODE AS C_CONTRACT_CODE, F.[CONTRACT_NAME] AS C_CONTRACT_NAME,  F.TOTAL_AMT AS C_TOTAL_AMT ,
				ISNULL((SELECT SUM(TR_PO.TOTAL_AMT) FROM TR_PO_MASTER TR_PO WHERE TR_PO.CONTRACT_ID = A.CONTRACT_ID AND A.CONTRACT_ID IS NOT NULL AND A.CONTRACT_ID <> ''),0) AS C_DONE_AMT, 
				 @p_RECEIVE_BRANCH AS RECEIVE_BRANCH,
				 CASE B.IS_UPDATE
				WHEN 'A' THEN N'Đã cập nhật'
				else N'Chưa cập nhật' END
				AS TRANGTHAI_CAPNHAT,
				D.AUTH_STATUS_NAME AS TRANGTHAI_DUYET,
				'POSC' AS POKIND
		FROM TR_PO_REPAIR A 
		LEFT JOIN TR_PO_UP_MASTER B ON A.PO_REPAIR_ID = B.PO_ID
		LEFT JOIN TR_CONTRACT C ON A.CONTRACT_ID = C.CONTRACT_ID  
		LEFT JOIN CM_AUTH_STATUS D ON D.AUTH_STATUS = B.AUTH_STATUS
		LEFT JOIN CM_SUPPLIER E ON E.SUP_ID= A.SUP_ID
		LEFT JOIN TR_CONTRACT F ON F.CONTRACT_ID = A.CONTRACT_ID --AND A.CONTRACT_ID IS NOT NULL
		WHERE 1 = 1
	   AND (A.PO_CODE LIKE '%' + @p_PO_CODE + '%' OR @p_PO_CODE IS NULL OR @p_PO_CODE = '')
		AND (A.PO_REPAIR_ID LIKE '%' + @p_PO_ID + '%' OR @p_PO_ID IS NULL OR @p_PO_ID = '')
		AND (A.TOTAL_AMT=@p_TOTAL_AMT OR @p_TOTAL_AMT IS NULL OR @p_TOTAL_AMT =0)
		AND (A.PO_NAME LIKE '%' + @p_PO_NAME + '%' OR @p_PO_NAME IS NULL OR @p_PO_NAME = '')
		AND (A.CONTRACT_ID LIKE '%' + @p_CONTRACT_ID + '%' OR @p_CONTRACT_ID IS NULL OR @p_CONTRACT_ID = '')
		AND (A.SUP_ID LIKE '%' + @p_SUP_ID + '%' OR @p_SUP_ID IS NULL OR @p_SUP_ID = '')
		--AND (A.SUP_ADDR LIKE '%' + @p_SUP_ADDR + '%' OR @p_SUP_ADDR IS NULL OR @p_SUP_ADDR = '')
		AND (DATEDIFF(DAY,A.INPUT_DT , CONVERT(DATETIME,@p_INPUT_DT,103))  =0 OR @p_INPUT_DT IS NULL OR @p_INPUT_DT = '')
		AND (DATEDIFF(DAY,A.PAYMENT_DT , CONVERT(DATETIME,@p_PAYMENT_DT,103))  =0 OR @p_PAYMENT_DT IS NULL OR @p_PAYMENT_DT = '')
		AND (A.REQ_DOC_ID LIKE '%' + @p_REQ_DOC_ID + '%' OR @p_REQ_DOC_ID IS NULL OR @p_REQ_DOC_ID = '')
		AND (DATEDIFF(DAY,A.DELIVERY_DT , CONVERT(DATETIME,@p_DELIVERY_DT,103)) = 0 OR @p_DELIVERY_DT IS NULL OR @p_DELIVERY_DT = '')
		AND (DATEDIFF(DAY,A.PAYAPP_DT , CONVERT(DATETIME,@p_PAYAPP_DT,103)) = 0 OR @p_PAYAPP_DT IS NULL OR @p_PAYAPP_DT = '')
		AND (A.RECORD_STATUS LIKE '%' + @p_RECORD_STATUS + '%' OR @p_RECORD_STATUS IS NULL OR @p_RECORD_STATUS = '')
		AND (A.MAKER_ID LIKE '%' + @p_MAKER_ID + '%' OR @p_MAKER_ID IS NULL OR @p_MAKER_ID = '')
		AND (DATEDIFF(DAY,A.CREATE_DT , CONVERT(DATETIME,@p_CREATE_DT,103)) = 0 OR @p_CREATE_DT IS NULL OR @p_CREATE_DT = '')
		AND A.AUTH_STATUS = 'A'
		AND (A.CHECKER_ID LIKE '%' + @p_CHECKER_ID + '%' OR @p_CHECKER_ID IS NULL OR @p_CHECKER_ID = '')
		AND (DATEDIFF(DAY,A.APPROVE_DT , CONVERT(DATETIME,@p_APPROVE_DT,103)) = 0 OR @p_APPROVE_DT IS NULL OR @p_APPROVE_DT = '')
		AND (A.INPUT_DT >= CONVERT(DATE,@P_FROM_DATE,103) OR @P_FROM_DATE = '' OR @P_FROM_DATE IS NULL)
		AND (A.INPUT_DT <= CONVERT(DATE,@P_TO_DATE,103) OR @P_TO_DATE = '' OR @P_TO_DATE IS NULL)
		AND (C.CONTRACT_CODE LIKE '%' + @P_CONTRACT_CODE + '%' OR @P_CONTRACT_CODE = '' OR @P_CONTRACT_CODE IS NULL)
		AND (A.PO_TYPE = @P_PO_TYPE OR @P_PO_TYPE IS NULL OR @P_PO_TYPE =-1) 
		--AND (@p_RECEIVE_BRANCH IS NULL OR A.PO_ID IN (SELECT PO_ID FROM TR_PO_DETAIL WHERE RECEIVE_BRANCH=@p_RECEIVE_BRANCH))
		AND (@p_RECEIVE_BRANCH IS NULL OR @p_RECEIVE_BRANCH = '' 
			OR EXISTS(SELECT PODT.PO_REPAIR_ID FROM TR_PO_REPAIR_DT PODT
						WHERE (PODT.RECEIVE_BRANCH = @p_RECEIVE_BRANCH AND PODT.PO_REPAIR_ID = A.PO_REPAIR_ID )
							  --OR (@l_BRANCH_TYPE = 'HS' AND PODT.PRICE > @l_ASSET_VALUE AND PODT.PO_ID = A.PO_ID)
							  ))
		AND A.RECORD_STATUS = '1'
		 AND ((@P_LEVEL = 'ALL' AND A.BRANCH_ID IN (SELECT BRANCH_ID from @tmp))
OR ((@P_LEVEL = 'UNIT' AND A.BRANCH_ID = @p_BRANCH_ID) OR (@p_BRANCH_ID = '' OR @p_BRANCH_ID IS NULL)))

		AND (B.AUTH_STATUS = @p_ISAPPROVE OR @p_ISAPPROVE IS NULL OR @p_ISAPPROVE = '')
		AND (
				(@p_ISUPDATE = 'A' AND A.PO_REPAIR_ID IN (SELECT UP1.PO_ID FROM TR_PO_UP_MASTER UP1))
				OR
				(@p_ISUPDATE = 'U' AND A.PO_REPAIR_ID NOT IN (SELECT UP2.PO_ID FROM TR_PO_UP_MASTER UP2))
				OR @p_ISUPDATE IS NULL OR @p_ISUPDATE = ''
			)
			AND (@p_SUP_ADDR = 'POSC' OR @p_SUP_ADDR = '' OR @p_SUP_ADDR IS NULL)
			ORDER BY PO_CODE DESC, INPUT_DT DESC
		)
		
		) A
		
		) SELECT * FROM QUERY_DATA WHERE __ROWNUM > 0 AND __ROWNUM <= 10
END-- PAGING END
   
go

----------------------------------------------------------------------------------------------------
delete TL_MENU where MENU_NAME_EL = 'BcConRequestDoc'
INSERT INTO [TL_MENU] ([MENU_ID],[MENU_NAME],[MENU_NAME_EL],[MENU_LINK_OLD],[MENU_PARENT],[MENU_LINK],[MENU_ICON],[MENU_PERMISSION],[MENU_ORDER],[AUTH_STATUS],[RECORD_STATUS],[HAS_TOOLBAR],[MAKER_ID],[CHECKER_ID],[DATE_APPROVE],[ISAPPROVE],[ISAPPROVE_FUNC],[CREATE_DT])VALUES(8268,N'Báo cáo theo dõi ngân sách',N'BcConRequestDoc',NULL,N'6363',N'/app/admin/re-con-request-doc',NULL,N'Pages.Administration.BcConRequestDoc',4,N'A',N'1',NULL,N'hungdv',N'hungdv',N'May 28 2020  4:41PM',NULL,N'1',N'Mar 12 2020 12:00AM')

----------------------------------------------------------------------------------------------------
delete ASS_INVENTORY_MASTER where RECORD_STATUS= '0'

DELETE ASS_INVENTORY_DT where INVENT_ID not in (select INVENT_ID from ASS_INVENTORY_MASTER)
